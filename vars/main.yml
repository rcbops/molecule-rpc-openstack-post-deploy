---
# vars file for molecule-rpc-openstack-post-deploy
public_key: "{{ lookup('file', '/root/.ssh/id_rsa.pub') }}"
ops_apt_util_packages:
  - bash-completion
  - bridge-utils
  - curl
  - dstat
  - htop
  - iotop
  - iptables-persistent
  - lsof
  - openssh-server
  - sudo
  - tcpdump
  - vim
  - screen
ops_apt_host_packages:
  - linux-crashdump
  - debootstrap
  - lvm2
  - ntp
  - ntpdate
  - vlan
image:
  name: Ubuntu 16.04
flavor:
  name: post-deploy
test_server: post-deploy-server
test_volume: post-deploy-volume
test_router: TEST-ROUTER
test_network: TEST-VXLAN
test_subnet: TEST-VXLAN-SUBNET
working_inventory: /tmp/inventory
gateway_network: GATEWAY_NET
private_network: PRIVATE_NET
custom_fact_path: /etc/ansible/facts.d

# vars for copying 'clouds.yaml' to the deployment host
overcloudrc_path: /home/stack/overcloudrc
os_config_path: /root/.config/openstack
os_clouds_yml_path: "{{ os_config_path }}/clouds.yaml"

# OSP undercloud values
undercloudrc_path: /home/stack/stackrc
undercloud_ssh_key: /home/stack/.ssh/id_rsa

# Create shared networks and subnets:
router_name: GATEWAY_NET_ROUTER
provider_net_name: GATEWAY_NET
provider_net_cidr: 10.0.248.0/22
provider_dns_server: "{{ DNS_NAMESERVER | default('8.8.8.8') }}"
provider_subnet_name: "{{ provider_net_name }}_SUBNET"

private_net_name: PRIVATE_NET
private_net_cidr: 192.168.0.0/24
private_subnet_name: "{{ private_net_name }}_SUBNET"
# set this conditionally depending on OSP (datacentre) or RPC (flat)
physical_network: datacentre

networks:
  - name: "{{ provider_net_name }}"
    shared: true
    external: true
    network_type: flat
    physical_network: "{{ physical_network }}"
  - name: "{{ private_net_name }}"
    shared: true
    external: true
    network_type: vxlan
    segmentation_id: 101
subnets:
  - name: "{{ provider_subnet_name }}"
    network_name: "{{ provider_net_name }}"
    ip_version: 4
    cidr: "{{ provider_net_cidr }}"
    gateway_ip: "{{ provider_net_cidr | ipaddr('1') | ipaddr('address') }}"
    enable_dhcp: "{{ enable_provider_net_dhcp | default(false) | bool }}"
    allocation_pool_start: "{{ provider_net_cidr | ipaddr('201') | ipaddr('address') }}"
    allocation_pool_end: "{{ provider_net_cidr | ipaddr('255') | ipaddr('address') }}"
    dns_nameservers:
      - "{{ provider_dns_server }}"
  - name: "{{ private_subnet_name }}"
    network_name: "{{ private_net_name }}"
    ip_version: 4
    cidr: "{{ private_net_cidr }}"
    gateway_ip: "{{ private_net_cidr | ipaddr('1') | ipaddr('address') }}"
    enable_dhcp: true
    allocation_pool_start: "{{ private_net_cidr | ipaddr('10') | ipaddr('address') }}"
    allocation_pool_end: "{{ private_net_cidr | ipaddr('254') | ipaddr('address') }}"
